<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>STL Face Painter to 3MF</title>
    <link rel="stylesheet" href="styles.css" />
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.162.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.162.0/examples/jsm/"
        }
      }
    </script>
  </head>
  <body>
    <aside class="panel">
      <h1>STL Face Painter</h1>
      <p class="hint">Upload an STL, pick 3 points to define a face plane, then draw or type.</p>

      <label class="field">
        <span>STL file</span>
        <input id="stlInput" type="file" accept=".stl" />
      </label>

      <div class="field">
        <span>Mode</span>
        <div class="row">
          <button id="pickFaceBtn">1) Pick face (3 points)</button>
          <button id="drawBtn" disabled>2) Draw</button>
          <button id="textBtn" disabled>3) Type</button>
        </div>
      </div>

      <div class="field">
        <span>Orientation refs</span>
        <div class="row">
          <button id="pickBottomBtn" disabled>Set bottom (3 points)</button>
          <button id="pickFrontBtn" disabled>Set front (3 points)</button>
        </div>
      </div>

      <label class="field">
        <span>Text</span>
        <input id="textInput" type="text" maxlength="32" value="TEXT" />
      </label>

      <label class="field">
        <span>Brush radius (mm)</span>
        <input id="brushSize" type="range" min="0.2" max="3" step="0.1" value="0.8" />
      </label>

      <div class="field checkbox-field">
        <span>Camera</span>
        <label class="checkbox-option"><input id="lockRotation" type="checkbox" /> Lock rotation while editing</label>
        <label class="checkbox-option"><input id="showFacePlane" type="checkbox" checked /> Show selected face plane</label>
      </div>

      <div class="field">
        <span>Color (max 4)</span>
        <div id="palette" class="palette"></div>
      </div>

      <div class="row">
        <button id="undoBtn" disabled>Undo stroke</button>
        <button id="redoBtn" disabled>Redo stroke</button>
        <button id="clearMarksBtn" disabled>Clear marks</button>
      </div>

      <div class="field">
        <span>Viewcube</span>
        <div id="viewCube" class="viewcube">
          <button data-view="top">Top</button>
          <button data-view="front">Front</button>
          <button data-view="right">Right</button>
          <button data-view="left">Left</button>
          <button data-view="back">Back</button>
          <button data-view="bottom">Bottom</button>
          <button data-view="iso">Iso</button>
        </div>
      </div>

      <button id="exportBtn" disabled>Export .3mf</button>
      <p class="hint small">
        Extrusions are inserted 0.4 mm into the model and exported as separate meshes (not merged with base).
      </p>
    </aside>

    <main>
      <canvas id="viewport"></canvas>
      <div id="status" class="status">Load an STL to begin.</div>
      <pre id="debug" class="debug">[debug] ready</pre>
    </main>

    <script type="module" src="app.js"></script>
  </body>
</html>
